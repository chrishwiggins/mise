#/bin/tcsh -f -X -V
#
# usage w/language: tesseract ocr_34483.tiff foo.txt -l fra

# takes as input an imagefile
# conversts to tiff
# tesseract's it (no flags [2])
 
# from atlassian [1], 2018-04-01
echo 
echo STARTING ocr on $1 at `date` ...

# convert to tiff
time convert -density 300 $1 -depth 8 -strip -background white -alpha off /tmp/ocr_$$.tiff
 
# -density 300 and -depth 8 control the resolution of the resulting TIFF image. OCR works best with high-resolution images; if you leave this out, you're likely to get garbled results.

echo "  - finished convert to tiff" $1 at `date` 
 
#"u -strip -background white -alpha off" removes any alpha channels, and makes the background white. Tesseract is rather picky about this kind of thing.

setenv input $1
shift
setenv options $*

echo "  - starting tesseract at" `date` with:
echo "    + input =" $input
echo "    + options =" $options
 
echo "  - starting"  tesseract  /tmp/ocr_$$.tiff $options $input:r at `date`
# most important line in the code:
#time tesseract  /tmp/ocr_$$.tiff $options $input:r
time tesseract  /tmp/ocr_$$.tiff $input:r $options
echo ...ENDING tesseract at `date`!
echo 
# maybe change this to mv -f after testing for a while.
mv -v -i ${input:r}.txt ${input:r}.ocr
#
# might need cleanup:
# rm -f /tmp/ocr_$$.tiff
# echo removed /tmp/ocr_$$.tiff

# [1] https://diging.atlassian.net/wiki/spaces/DCH/pages/5275668/Tutorial+Text+Extraction+and+OCR+with+Tesseract+and+ImageMagick 
# [2]
# Usage:
#    tesseract --help | --help-psm | --help-oem | --version
#    tesseract --list-langs [--tessdata-dir PATH]
#    tesseract --print-parameters [options...] [configfile...]
#    tesseract imagename|stdin outputbase|stdout [options...] [configfile...]
#  
#  OCR options:
#    --tessdata-dir PATH   Specify the location of tessdata path.
#    --user-words PATH     Specify the location of user words file.
#    --user-patterns PATH  Specify the location of user patterns file.
#    -l LANG[+LANG]        Specify language(s) used for OCR.
#    -c VAR=VALUE          Set value for config variables.
#                          Multiple -c arguments are allowed.
#    --psm NUM             Specify page segmentation mode.
#    --oem NUM             Specify OCR Engine mode.
#  NOTE: These options must occur before any configfile.
#  
#  Page segmentation modes:
#    0    Orientation and script detection (OSD) only.
#    1    Automatic page segmentation with OSD.
#    2    Automatic page segmentation, but no OSD, or OCR.
#    3    Fully automatic page segmentation, but no OSD. (Default)
#    4    Assume a single column of text of variable sizes.
#    5    Assume a single uniform block of vertically aligned text.
#    6    Assume a single uniform block of text.
#    7    Treat the image as a single text line.
#    8    Treat the image as a single word.
#    9    Treat the image as a single word in a circle.
#   10    Treat the image as a single character.
#   11    Sparse text. Find as much text as possible in no particular order.
#   12    Sparse text with OSD.
#   13    Raw line. Treat the image as a single text line,
#        bypassing hacks that are Tesseract-specific.
#  OCR Engine modes:
#    0    Original Tesseract only.
#    1    Cube only.
#    2    Tesseract + cube.
#    3    Default, based on what is available.
#  
#  Single options:
#    -h, --help            Show this help message.
#    --help-psm            Show page segmentation modes.
#    --help-oem            Show OCR Engine modes.
#    -v, --version         Show version information.
#    --list-langs          List available languages for tesseract engine.
#    --print-parameters    Print tesseract parameters to stdout.
#
#
# List of available languages in "/opt/homebrew/share/tessdata/" (163):
# afr
# amh
# ara
# asm
# aze
# aze_cyrl
# bel
# ben
# bod
# bos
# bre
# bul
# cat
# ceb
# ces
# chi_sim
# chi_sim_vert
# chi_tra
# chi_tra_vert
# chr
# cos
# cym
# dan
# deu
# div
# dzo
# ell
# eng
# enm
# epo
# equ
# est
# eus
# fao
# fas
# fil
# fin
# fra
# frk
# frm
# fry
# gla
# gle
# glg
# grc
# guj
# hat
# heb
# hin
# hrv
# hun
# hye
# iku
# ind
# isl
# ita
# ita_old
# jav
# jpn
# jpn_vert
# kan
# kat
# kat_old
# kaz
# khm
# kir
# kmr
# kor
# kor_vert
# lao
# lat
# lav
# lit
# ltz
# mal
# mar
# mkd
# mlt
# mon
# mri
# msa
# mya
# nep
# nld
# nor
# oci
# ori
# osd
# pan
# pol
# por
# pus
# que
# ron
# rus
# san
# script/Arabic
# script/Armenian
# script/Bengali
# script/Canadian_Aboriginal
# script/Cherokee
# script/Cyrillic
# script/Devanagari
# script/Ethiopic
# script/Fraktur
# script/Georgian
# script/Greek
# script/Gujarati
# script/Gurmukhi
# script/HanS
# script/HanS_vert
# script/HanT
# script/HanT_vert
# script/Hangul
# script/Hangul_vert
# script/Hebrew
# script/Japanese
# script/Japanese_vert
# script/Kannada
# script/Khmer
# script/Lao
# script/Latin
# script/Malayalam
# script/Myanmar
# script/Oriya
# script/Sinhala
# script/Syriac
# script/Tamil
# script/Telugu
# script/Thaana
# script/Thai
# script/Tibetan
# script/Vietnamese
# sin
# slk
# slv
# snd
# snum
# spa
# spa_old
# sqi
# srp
# srp_latn
# sun
# swa
# swe
# syr
# tam
# tat
# tel
# tgk
# tha
# tir
# ton
# tur
# uig
# ukr
# urd
# uzb
# uzb_cyrl
# vie
# yid
# yor

